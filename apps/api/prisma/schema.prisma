generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Location {
  id            String   @id @default(cuid())
  googlePlaceId String?  @unique
  name          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  reviews       Review[]
}

model Review {
  id             String   @id @default(cuid())
  locationId     String
  googleReviewId String?  @unique

  reviewerName     String
  reviewerPhotoUrl String?
  rating           Int
  text             String
  reviewUrl        String?
  reviewTime       DateTime

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  location       Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  mentions       EmployeeMention[]
  alerts         AlertLog[]
}

model Employee {
  id        String   @id @default(cuid())
  fullName  String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  mentions  EmployeeMention[]
}

model EmployeeMention {
  id         String   @id @default(cuid())
  reviewId   String
  employeeId String
  confidence Float    @default(1.0)
  createdAt  DateTime @default(now())

  review     Review    @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  employee   Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([reviewId, employeeId])
}

model AlertLog {
  id        String   @id @default(cuid())
  reviewId  String
  type      String
  message   String
  createdAt DateTime @default(now())

  review    Review    @relation(fields: [reviewId], references: [id], onDelete: Cascade)
}
